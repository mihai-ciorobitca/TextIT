<!DOCTYPE html>
<html>
  <head>
    <title>Real-time Chat</title>
    
  </head>
  <body>
    <div id="messages"></div>
    <input type="text" id="message-input" placeholder="Type your message..." />
    <button id="send-button">Send</button>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    
      const supabaseUrl = "{{ supabase_url }}";
      const supabaseKey = "{{ supabase_key }}";
      const supabase = createClient(supabaseUrl, supabaseKey);
    
      const messagesContainer = document.getElementById("messages");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");
    
      function loadMessages() {
        supabase
          .from("messages")
          .select("content")
          .then(({ data }) => {
            messagesContainer.innerHTML = "";
            data.forEach((message) => {
              const messageElement = document.createElement("div");
              messageElement.textContent = message.content;
              messagesContainer.appendChild(messageElement);
            });
          });
      }
    
      loadMessages();
    
      const mySubscription = supabase
        .from("messages")
        .on("INSERT", loadMessages)
        .subscribe();
    
      sendButton.addEventListener("click", () => {
        const message = messageInput.value;
        if (message) {
          fetch("/send_message", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: `message=${encodeURIComponent(message)}`,
          })
            .then(() => {
              messageInput.value = "";
            })
            .catch((error) => {
              console.error("Error sending message:", error);
            });
        }
      });
    </script>
    
  </body>
</html>
